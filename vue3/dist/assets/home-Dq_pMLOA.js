import{d as z,r as y,_ as S,a,o as m,c as T,w as s,b as L,u as g,e as v,f as e,g as p,t as k,E as q,h as V,i as W,j as D,F as $,k as P,n as j,p as K,l as Q,m as G,q as N,s as X,v as E,x as Y,y as Z,z as ee,A as te,B as R,C as oe,D as ne,T as se,G as ae}from"./index-DP5XNW4p.js";import{u as M,a as B}from"./github-markdown-B7qAf7ZR.js";import"./index-CyhALC0r.js";const A=z("history",()=>{const r=M(),t=y([]);let c=y();return{windowId:c,history:t,addConversationToHistory:()=>{const o=t.value.find(l=>l.id===c.value);if(o&&r.messageList.length>0&&(o.messageList=JSON.parse(JSON.stringify(r.messageList))),r.messageList.length>0){const l=Date.now();c.value=l,t.value.push({id:l,messageList:[]}),r.messageList=[]}},deleteConversation:o=>{const l=t.value.findIndex(d=>d.id===o);l!==-1&&t.value.splice(l,1)},deleteAll:()=>{t.value=[]}}},{persist:{key:"HistoryTalk",paths:["windowId","history"]}}),le={__name:"newChat_btn",setup(r){const t=A();return(c,n)=>{const i=a("el-button");return m(),T(i,{color:"black",class:"btn",onClick:n[0]||(n[0]=_=>{g(t).addConversationToHistory()})},{default:s(()=>[L("新建聊天")]),_:1})}}},ce=S(le,[["__scopeId","data-v-9b3145f6"]]),ie={class:"window"},re={class:"text"},de={__name:"window",props:{content:String,historyId:String},setup(r){A();function t(c){const n=document.createElement("div");return n.innerHTML=c,n.textContent||n.innerText||""}return(c,n)=>{const i=a("ChatDotSquare"),_=a("el-icon");return m(),v("p",ie,[e(_,{class:"ChatDotSquare"},{default:s(()=>[e(i)]),_:1}),p("span",re,k(t(r.content)),1)])}}},_e=S(de,[["__scopeId","data-v-195c713d"]]),U=""+new URL("user-DsFVknIh.png",import.meta.url).href,ue={class:"container"},pe=p("img",{src:U,class:"user-image"},null,-1),me=p("span",{class:"welcome-text"},"欢迎使用mychat",-1),fe={__name:"footer",setup(r){const t=A();function c(){q.confirm("确定要删除所有对话记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{n(),V({type:"success",message:"对话记录已删除"})}).catch(()=>{V({type:"info",message:"已取消删除"})})}function n(){t.deleteAll(),t.windowId=Date.now(),t.history.push({id:t.windowId,messageList:[]}),difyStore.messageList=[]}return(i,_)=>{const o=a("el-icon"),l=a("Setting"),d=a("el-dropdown-item"),u=a("el-dropdown-menu"),f=a("el-dropdown");return m(),v("div",ue,[pe,me,e(o,{class:"Setting"}),e(f,null,{dropdown:s(()=>[e(u,null,{default:s(()=>[e(d,{onClick:c},{default:s(()=>[L("删除对话记录")]),_:1}),e(d,{divided:"",disabled:""},{default:s(()=>[L("登录")]),_:1})]),_:1})]),default:s(()=>[e(o,{class:"Setting"},{default:s(()=>[e(l)]),_:1})]),_:1})])}}},ge={__name:"sidebar",setup(r){const t=A(),c=M(),n=W(()=>[...t.history].reverse()),i=o=>{if(t.history.find(d=>d.id===t.windowId)){const d=t.history.find(u=>u.id===t.windowId);d&&(d.messageList=JSON.parse(JSON.stringify(c.messageList)))}else{const d={id:t.windowId,messageList:JSON.parse(JSON.stringify(c.messageList))};t.history.push(d)}t.windowId=o;const l=t.history.find(d=>d.id===o);l&&(c.messageList=JSON.parse(JSON.stringify(l.messageList)))};D(()=>{c.messageList.length>0&&(t.deleteConversation(t.windowId),t.history.push({id:t.windowId,messageList:c.messageList}));const o=t.history.find(l=>l.messageList.length===0);o?(t.windowId=o.id,c.messageList=o.messageList):(t.windowId=Date.now(),t.history.push({id:t.windowId,messageList:[]}),c.messageList=[])});function _(o){t.deleteConversation(o)}return(o,l)=>{const d=a("el-header"),u=a("Delete"),f=a("el-icon"),b=a("el-main"),h=a("el-footer"),x=a("DArrowLeft"),I=a("el-container");return m(),T(I,{style:{position:"relative"}},{default:s(()=>[e(d,{style:{padding:"0"},height:"40px"},{default:s(()=>[e(ce)]),_:1}),e(b,{style:{padding:"0"}},{default:s(()=>[(m(!0),v($,null,P(n.value,w=>{var H;return m(),v("div",{key:w.id,style:{position:"relative"}},[e(_e,{content:(H=w.messageList[0])!=null&&H.user?w.messageList[0].user:"新建聊天",historyId:w.id,onClick:C=>i(w.id),style:j({backgroundColor:g(t).windowId===w.id?"#dadada":"",color:g(t).windowId===w.id?"#058a2d":""})},null,8,["content","historyId","onClick","style"]),e(f,{class:"DeleteIcon",onClick:C=>_(w.id)},{default:s(()=>[e(u)]),_:2},1032,["onClick"])])}),128))]),_:1}),e(h,{style:{padding:"0"}},{default:s(()=>[e(fe)]),_:1}),e(f,{class:"DArrowLeft",onClick:l[0]||(l[0]=w=>o.$emit("toggleSidebar"))},{default:s(()=>[e(x)]),_:1})]),_:1})}}},ve=S(ge,[["__scopeId","data-v-75cb1635"]]),he=[{version:"2.0.5",updateMessage:"已更新GPTs功能!",updateTime:"2024.8.24"},{version:"2.0.4",updateMessage:"支持自定义上下文联系长度",updateTime:"2024.8.23"},{version:"2.0.3",updateMessage:"支持保存对话历史",updateTime:"2024.8.22"},{version:"2.0.2",updateMessage:"完成AI对话",updateTime:"2024.8.22"},{version:"2.0.1",updateMessage:"继续完善基本框架",updateTime:"2024.8.20"},{version:"2.0.0",updateMessage:"重新构建mychat2.0界面",updateTime:"2024.8.19"}],F={Logs:he},we={__name:"update",setup(r){const t=F.Logs.map(c=>({version:c.version,updateMessage:c.updateMessage,updateTime:c.updateTime}));return(c,n)=>{const i=a("el-tag"),_=a("el-table-column"),o=a("el-table"),l=a("el-popover");return m(),T(l,{placement:"bottom",width:360,trigger:"click"},{reference:s(()=>[e(i,{class:"tag",type:"success",round:""},{default:s(()=>[L(k(g(F).Logs[0].version)+"更新日志",1)]),_:1})]),default:s(()=>[e(o,{data:g(t),"max-height":240},{default:s(()=>[e(_,{width:"60",property:"version",label:"版本"}),e(_,{width:"180",property:"updateMessage",label:"日志"}),e(_,{width:"",property:"updateTime",label:"时间"})]),_:1},8,["data"])]),_:1})}}},ye=S(we,[["__scopeId","data-v-8c2a70d9"]]),be=r=>(K("data-v-9a7e1e47"),r=r(),Q(),r),xe={class:"contentWrapper"},Ce=be(()=>p("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--heroicons",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24"},[p("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09m8.445-7.188L18 9.75l-.259-1.035a3.38 3.38 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.38 3.38 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.38 3.38 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.38 3.38 0 0 0-2.456 2.456m-1.365 11.852L16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183l.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394l-1.183.394a2.25 2.25 0 0 0-1.423 1.423"})],-1)),Le={class:"tagWord"},Se={class:"dialog-footer"},ke={__name:"modelSetting",setup(r){const t=B(),c=M(),n=y(!1);y("gpt-4o");function i(){n.value=!0}return(_,o)=>{const l=a("ArrowRightBold"),d=a("el-icon"),u=a("el-tag"),f=a("el-input-number"),b=a("el-form-item"),h=a("el-option"),x=a("el-select"),I=a("el-form"),w=a("el-button"),H=a("el-dialog");return m(),v($,null,[e(u,{class:"ml-2 modelSetting",type:"info",onClick:i},{default:s(()=>[p("div",xe,[Ce,p("span",Le,[L(k(g(t).AImodel)+" ",1),e(d,null,{default:s(()=>[e(l)]),_:1})])])]),_:1}),e(H,{modelValue:n.value,"onUpdate:modelValue":o[4]||(o[4]=C=>n.value=C),title:"模型设置",center:"",class:"modelDialog"},{footer:s(()=>[p("span",Se,[e(w,{onClick:o[2]||(o[2]=C=>n.value=!1)},{default:s(()=>[L("取消")]),_:1}),e(w,{type:"primary",onClick:o[3]||(o[3]=C=>n.value=!1)},{default:s(()=>[L("确认")]),_:1})])]),default:s(()=>[e(I,{model:_.form},{default:s(()=>[e(b,{label:"上下文联系条数"},{default:s(()=>[e(f,{modelValue:g(c).context_length,"onUpdate:modelValue":o[0]||(o[0]=C=>g(c).context_length=C),min:0,max:25},null,8,["modelValue"])]),_:1}),e(b,{label:"模型选择"},{default:s(()=>[e(x,{modelValue:g(t).AImodel,"onUpdate:modelValue":o[1]||(o[1]=C=>g(t).AImodel=C),placeholder:"选择默认模型",disabled:""},{default:s(()=>[e(h,{label:"gpt-4o-mini",value:"gpt-4o-mini"}),e(h,{label:"gpt-4o",value:"gpt-4o"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},Ie=S(ke,[["__scopeId","data-v-9a7e1e47"]]),$e={style:{position:"relative"}},Te={class:"title"},De={__name:"headbar",setup(r){return(t,c)=>{const n=a("Expand"),i=a("el-icon");return m(),v("div",$e,[e(i,{class:"Fold",onClick:c[0]||(c[0]=_=>t.$emit("toggleSidebar"))},{default:s(()=>[e(n)]),_:1}),p("span",Te,[L("MyChat2.0 "),e(ye)]),e(Ie)])}}},Me=S(De,[["__scopeId","data-v-7d0ad1e5"]]),Ae={class:"user-container"},He=["innerHTML"],Ve=p("img",{src:U,alt:"user",class:"userImg"},null,-1),Pe={__name:"user",props:{content:String},setup(r){const t=r,c=()=>{const n=document.createElement("textarea"),i=document.createElement("div");i.innerHTML=t.content,n.value=i.textContent||i.innerText||"",document.body.appendChild(n),n.select();try{document.execCommand("copy"),V.success("复制成功")}catch{V.error("复制失败")}document.body.removeChild(n)};return(n,i)=>{const _=a("el-card");return m(),v("div",Ae,[e(_,{class:"userCard",onClick:c},{default:s(()=>[p("p",{innerHTML:r.content,class:"markdown-body"},null,8,He)]),_:1}),Ve])}}},Be={class:"assistant-container"},Ee=["src"],Ne=["innerHTML"],Fe={style:{margin:"0"}},O={__name:"assistant",props:{content:String,index:Number},emits:["deleteMessage"],setup(r,{emit:t}){const c=B(),n=r,i=y(!1),_=y(null),o=()=>{const u=_.value.innerText||_.value.textContent;navigator.clipboard.writeText(u).then(()=>{i.value=!0,setTimeout(()=>{i.value=!1},2e3)}).catch(f=>{console.error("复制失败",f)})},l=t,d=()=>{l("deleteMessage",n.index)};return(u,f)=>{const b=a("Delete"),h=a("el-icon"),x=a("MoreFilled"),I=a("el-popover"),w=a("el-card");return m(),v("div",Be,[p("img",{src:g(c).AIphoto,alt:"assistant",class:"assistantImg"},null,8,Ee),e(w,{class:"assistantCard"},{default:s(()=>[p("p",{ref_key:"contentRef",ref:_,innerHTML:r.content,class:"markdown-body"},null,8,Ne),e(I,{placement:"right-end",trigger:"click","popper-class":"custom-popover"},{reference:s(()=>[e(h,{class:"MoreFilled"},{default:s(()=>[e(x)]),_:1})]),default:s(()=>[p("div",Fe,[p("p",{class:"custom-p",onClick:d},[e(h,{style:{width:"20px",margin:"6px"}},{default:s(()=>[e(b)]),_:1}),L(" 删除 ")]),p("p",{class:"custom-p",onClick:o},[e(h,{style:{width:"20px",margin:"6px"}},{default:s(()=>[(m(),T(G(i.value?"DocumentChecked":"DocumentCopy")))]),_:1}),p("span",null,k(i.value?"已复制":"复制"),1)])])]),_:1})]),_:1})])}}};function Oe(){const r=y(null);let t=!0;const c=()=>{const i=r.value;i.scrollTop=i.scrollHeight-i.clientHeight},n=()=>{const i=r.value;i.scrollHeight-i.clientHeight-5<=i.scrollTop?t=!0:t=!1};return D(()=>{const i=r.value;new MutationObserver(()=>{t&&N(()=>{c()})}).observe(i,{childList:!0,subtree:!0}),N(()=>{c()})}),{chatContainer:r,handleScroll:n}}const Je={__name:"mainPart",setup(r){const{chatContainer:t,handleScroll:c}=Oe(),n=B(),i=M(),_=o=>{i.messageList.splice(o,1)};return(o,l)=>(m(),v("div",{class:"chat-container",ref_key:"chatContainer",ref:t,onScroll:l[0]||(l[0]=(...d)=>g(c)&&g(c)(...d))},[e(O,{content:g(n).prologue},null,8,["content"]),(m(!0),v($,null,P(g(i).messageList,(d,u)=>(m(),v("div",{key:u},[e(Pe,{content:d.user},null,8,["content"]),e(O,{content:d.assistant,index:u,onDeleteMessage:_},null,8,["content","index"])]))),128))],544))}},Ge=S(Je,[["__scopeId","data-v-51cb003c"]]),Re={class:"container"},Ue=["onClick"],ze=["src"],qe={__name:"GPTs",emits:["closeDrawer"],setup(r,{emit:t}){const c=A(),n=B(),i=y([]);D(async()=>{try{const l=await X.get("/api/GPTs/");i.value=l.data}catch(l){console.error("请求数据时发生错误:",l)}});const _=t,o=l=>{c.addConversationToHistory(),n.setprologue(l.prologue),n.setUrl(l.url),n.setAImodel(l.title),n.setAIphoto(l.img),_("closeDrawer")};return(l,d)=>(m(),v("div",Re,[(m(!0),v($,null,P(i.value,(u,f)=>(m(),v("div",{class:"item",key:f,onClick:b=>o(u)},[p("img",{style:{"border-radius":"100%"},src:u.img,alt:"图片"},null,8,ze),p("h3",null,k(u.title),1),p("p",null,k(u.context),1)],8,Ue))),128))]))}},We=S(qe,[["__scopeId","data-v-3336bc37"]]),je={class:"icon-text-container"},J={__name:"footbar",setup(r){const t=y(!1),c=[{icon:Y,text:"聊天"},{icon:Z,text:"GPTs"},{icon:ee,text:"绘画"},{icon:te,text:"更多"}],n=y("btt"),i=y(0),_=o=>{i.value=o,o===1&&(t.value=!0)};return D(()=>{const o=()=>{window.innerWidth>1024?n.value="ltr":n.value="btt"};o(),window.addEventListener("resize",o)}),(o,l)=>{const d=a("el-icon"),u=a("el-col"),f=a("el-row"),b=a("el-drawer");return m(),v($,null,[e(f,null,{default:s(()=>[(m(),v($,null,P(c,(h,x)=>e(u,{key:x,span:6,class:E(["center-content",{active:i.value===x}]),onClick:I=>_(x)},{default:s(()=>[p("div",je,[e(d,{class:E({"active-icon":i.value===x})},{default:s(()=>[(m(),T(G(h.icon)))]),_:2},1032,["class"]),p("div",{class:E([{"active-text":i.value===x},"icon-text"])},k(h.text),3)])]),_:2},1032,["onClick","class"])),64))]),_:1}),e(b,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=h=>t.value=h),title:"GPTs",direction:n.value,size:500},{default:s(()=>[e(We,{onCloseDrawer:l[0]||(l[0]=h=>t.value=!1)})]),_:1},8,["modelValue","direction"])],64)}}},Ke={class:"input-container"},Qe=["disabled"],Xe={__name:"inputbar",setup(r){const t=y(null),c=()=>{const o=t.value;o.style.height="40px",o.style.height=`${o.scrollHeight}px`};D(()=>{c()});const n=M(),i=o=>{if(o.keyCode===13&&!o.shiftKey){o.preventDefault(),n.sendMessage();const l=t.value;l.style.height="40px"}},_=()=>{n.sendMessage();const o=t.value;o.style.height="40px"};return(o,l)=>{const d=a("Promotion"),u=a("el-icon"),f=a("Paperclip");return m(),v("div",Ke,[R(p("textarea",{placeholder:"请输入问题",class:"inputstyle",onInput:c,ref_key:"textarea",ref:t,"onUpdate:modelValue":l[0]||(l[0]=b=>g(n).user=b),onKeyup:ne(i,["enter"])},null,544),[[oe,g(n).user]]),p("button",{class:"send-button",onClick:_,disabled:g(n).loading},[e(u,{style:{"font-size":"20px",margin:"0"}},{default:s(()=>[e(d)]),_:1})],8,Qe),e(u,{class:"Paperclip"},{default:s(()=>[e(f)]),_:1})])}}},Ye=S(Xe,[["__scopeId","data-v-f0563944"]]),Ze={class:"common-layout"},nt={__name:"home",setup(r){const t=y(!1),c=y(null);function n(){t.value=!t.value}return(i,_)=>{const o=a("el-aside"),l=a("el-header"),d=a("el-main"),u=a("el-footer"),f=a("el-container");return m(),v("div",Ze,[e(f,null,{default:s(()=>[e(o,{class:"menu"},{default:s(()=>[e(J)]),_:1}),e(se,{name:"slide-fade"},{default:s(()=>[R(e(o,{class:"sidebar",ref_key:"sidebarRef",ref:c},{default:s(()=>[e(ve,{onToggleSidebar:n})]),_:1},512),[[ae,t.value]])]),_:1}),e(f,null,{default:s(()=>[e(l,{class:"headbar"},{default:s(()=>[e(Me,{onToggleSidebar:n})]),_:1}),e(d,{class:"mainPart"},{default:s(()=>[e(Ge)]),_:1}),e(Ye),e(u,{class:"footbar"},{default:s(()=>[e(J)]),_:1})]),_:1})]),_:1})])}}};export{nt as default};
