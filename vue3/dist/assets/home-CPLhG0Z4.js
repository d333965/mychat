import{d as F,r as w,_ as L,a as l,o as u,c as H,w as i,b as I,u as f,e as g,f as t,g as p,t as C,E as q,h as N,i as R,j as k,F as $,k as V,n as W,p as j,l as K,m as E,q as Q,s as B,v as X,x as Y,y as Z,z as ee,A as te,B as U,C as oe,D as ne,T as se,G as ae}from"./index-kUCnM5CB.js";import{u as T,a as P}from"./github-markdown--FzGPgqJ.js";import"./index-C4A4NB5u.js";const D=F("history",()=>{const r=T(),e=w([]);let a=w();return{windowId:a,history:e,addConversationToHistory:()=>{const o=e.value.find(n=>n.id===a.value);if(o&&r.messageList.length>0&&(o.messageList=JSON.parse(JSON.stringify(r.messageList))),r.messageList.length>0){const n=Date.now();a.value=n,e.value.push({id:n,messageList:[]}),r.messageList=[]}},deleteConversation:o=>{const n=e.value.findIndex(d=>d.id===o);n!==-1&&e.value.splice(n,1)},deleteAll:()=>{e.value=[]}}},{persist:{key:"HistoryTalk",paths:["windowId","history"]}}),le={__name:"newChat_btn",setup(r){const e=D();return(a,s)=>{const c=l("el-button");return u(),H(c,{color:"black",class:"btn",onClick:s[0]||(s[0]=_=>{f(e).addConversationToHistory()})},{default:i(()=>[I("新建聊天")]),_:1})}}},ie=L(le,[["__scopeId","data-v-9b3145f6"]]),ce={class:"window"},re={class:"text"},de={__name:"window",props:{content:String,historyId:String},setup(r){D();function e(a){const s=document.createElement("div");return s.innerHTML=a,s.textContent||s.innerText||""}return(a,s)=>{const c=l("ChatDotSquare"),_=l("el-icon");return u(),g("p",ce,[t(_,{class:"ChatDotSquare"},{default:i(()=>[t(c)]),_:1}),p("span",re,C(e(r.content)),1)])}}},_e=L(de,[["__scopeId","data-v-195c713d"]]),z=""+new URL("user-DsFVknIh.png",import.meta.url).href,ue={class:"container"},pe=p("img",{src:z,class:"user-image"},null,-1),me=p("span",{class:"welcome-text"},"欢迎使用mychat",-1),fe={__name:"footer",setup(r){const e=D();function a(){q.confirm("确定要删除所有对话记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{s(),N({type:"success",message:"对话记录已删除"})}).catch(()=>{N({type:"info",message:"已取消删除"})})}function s(){e.deleteAll(),e.windowId=Date.now(),e.history.push({id:e.windowId,messageList:[]}),difyStore.messageList=[]}return(c,_)=>{const o=l("el-icon"),n=l("Setting"),d=l("el-dropdown-item"),m=l("el-dropdown-menu"),h=l("el-dropdown");return u(),g("div",ue,[pe,me,t(o,{class:"Setting"}),t(h,null,{dropdown:i(()=>[t(m,null,{default:i(()=>[t(d,{onClick:a},{default:i(()=>[I("删除对话记录")]),_:1}),t(d,{divided:"",disabled:""},{default:i(()=>[I("登录")]),_:1})]),_:1})]),default:i(()=>[t(o,{class:"Setting"},{default:i(()=>[t(n)]),_:1})]),_:1})])}}},ge={__name:"sidebar",setup(r){const e=D(),a=T(),s=R(()=>[...e.history].reverse()),c=o=>{if(e.history.find(d=>d.id===e.windowId)){const d=e.history.find(m=>m.id===e.windowId);d&&(d.messageList=JSON.parse(JSON.stringify(a.messageList)))}else{const d={id:e.windowId,messageList:JSON.parse(JSON.stringify(a.messageList))};e.history.push(d)}e.windowId=o;const n=e.history.find(d=>d.id===o);n&&(a.messageList=JSON.parse(JSON.stringify(n.messageList)))};k(()=>{a.messageList.length>0&&(e.deleteConversation(e.windowId),e.history.push({id:e.windowId,messageList:a.messageList}));const o=e.history.find(n=>n.messageList.length===0);o?(e.windowId=o.id,a.messageList=o.messageList):(e.windowId=Date.now(),e.history.push({id:e.windowId,messageList:[]}),a.messageList=[])});function _(o){e.deleteConversation(o)}return(o,n)=>{const d=l("el-header"),m=l("Delete"),h=l("el-icon"),b=l("el-main"),y=l("el-footer"),x=l("DArrowLeft"),A=l("el-container");return u(),H(A,{style:{position:"relative"}},{default:i(()=>[t(d,{style:{padding:"0"},height:"40px"},{default:i(()=>[t(ie)]),_:1}),t(b,{style:{padding:"0"}},{default:i(()=>[(u(!0),g($,null,V(s.value,v=>{var M;return u(),g("div",{key:v.id,style:{position:"relative"}},[t(_e,{content:(M=v.messageList[0])!=null&&M.user?v.messageList[0].user:"新建聊天",historyId:v.id,onClick:S=>c(v.id),style:W({backgroundColor:f(e).windowId===v.id?"#dadada":"",color:f(e).windowId===v.id?"#058a2d":""})},null,8,["content","historyId","onClick","style"]),t(h,{class:"DeleteIcon",onClick:S=>_(v.id)},{default:i(()=>[t(m)]),_:2},1032,["onClick"])])}),128))]),_:1}),t(y,{style:{padding:"0"}},{default:i(()=>[t(fe)]),_:1}),t(h,{class:"DArrowLeft",onClick:n[0]||(n[0]=v=>o.$emit("toggleSidebar"))},{default:i(()=>[t(x)]),_:1})]),_:1})}}},he=L(ge,[["__scopeId","data-v-75cb1635"]]),ve=[{version:"2.0.5",updateMessage:"已更新GPTs功能!",updateTime:"2024.8.24"},{version:"2.0.4",updateMessage:"支持自定义上下文联系长度",updateTime:"2024.8.23"},{version:"2.0.3",updateMessage:"支持保存对话历史",updateTime:"2024.8.22"},{version:"2.0.2",updateMessage:"完成AI对话",updateTime:"2024.8.22"},{version:"2.0.1",updateMessage:"继续完善基本框架",updateTime:"2024.8.20"},{version:"2.0.0",updateMessage:"重新构建mychat2.0界面",updateTime:"2024.8.19"}],O={Logs:ve},we={__name:"update",setup(r){const e=O.Logs.map(a=>({version:a.version,updateMessage:a.updateMessage,updateTime:a.updateTime}));return(a,s)=>{const c=l("el-tag"),_=l("el-table-column"),o=l("el-table"),n=l("el-popover");return u(),H(n,{placement:"bottom",width:360,trigger:"click"},{reference:i(()=>[t(c,{class:"tag",type:"success",round:""},{default:i(()=>[I(C(f(O).Logs[0].version)+"更新日志",1)]),_:1})]),default:i(()=>[t(o,{data:f(e),"max-height":240},{default:i(()=>[t(_,{width:"60",property:"version",label:"版本"}),t(_,{width:"180",property:"updateMessage",label:"日志"}),t(_,{width:"",property:"updateTime",label:"时间"})]),_:1},8,["data"])]),_:1})}}},ye=L(we,[["__scopeId","data-v-8c2a70d9"]]),be=r=>(j("data-v-9a7e1e47"),r=r(),K(),r),xe={class:"contentWrapper"},Se=be(()=>p("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--heroicons",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24"},[p("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09m8.445-7.188L18 9.75l-.259-1.035a3.38 3.38 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.38 3.38 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.38 3.38 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.38 3.38 0 0 0-2.456 2.456m-1.365 11.852L16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183l.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394l-1.183.394a2.25 2.25 0 0 0-1.423 1.423"})],-1)),Le={class:"tagWord"},Ie={class:"dialog-footer"},Ce={__name:"modelSetting",setup(r){const e=P(),a=T(),s=w(!1);w("gpt-4o");function c(){s.value=!0}return(_,o)=>{const n=l("ArrowRightBold"),d=l("el-icon"),m=l("el-tag"),h=l("el-input-number"),b=l("el-form-item"),y=l("el-option"),x=l("el-select"),A=l("el-form"),v=l("el-button"),M=l("el-dialog");return u(),g($,null,[t(m,{class:"ml-2 modelSetting",type:"info",onClick:c},{default:i(()=>[p("div",xe,[Se,p("span",Le,[I(C(f(e).AImodel)+" ",1),t(d,null,{default:i(()=>[t(n)]),_:1})])])]),_:1}),t(M,{modelValue:s.value,"onUpdate:modelValue":o[4]||(o[4]=S=>s.value=S),title:"模型设置",center:"",class:"modelDialog"},{footer:i(()=>[p("span",Ie,[t(v,{onClick:o[2]||(o[2]=S=>s.value=!1)},{default:i(()=>[I("取消")]),_:1}),t(v,{type:"primary",onClick:o[3]||(o[3]=S=>s.value=!1)},{default:i(()=>[I("确认")]),_:1})])]),default:i(()=>[t(A,{model:_.form},{default:i(()=>[t(b,{label:"上下文联系条数"},{default:i(()=>[t(h,{modelValue:f(a).context_length,"onUpdate:modelValue":o[0]||(o[0]=S=>f(a).context_length=S),min:0,max:25},null,8,["modelValue"])]),_:1}),t(b,{label:"模型选择"},{default:i(()=>[t(x,{modelValue:f(e).AImodel,"onUpdate:modelValue":o[1]||(o[1]=S=>f(e).AImodel=S),placeholder:"选择默认模型",disabled:""},{default:i(()=>[t(y,{label:"gpt-4o-mini",value:"gpt-4o-mini"}),t(y,{label:"gpt-4o",value:"gpt-4o"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},$e=L(Ce,[["__scopeId","data-v-9a7e1e47"]]),ke={style:{position:"relative"}},Te={class:"title"},De={__name:"headbar",setup(r){return(e,a)=>{const s=l("Expand"),c=l("el-icon");return u(),g("div",ke,[t(c,{class:"Fold",onClick:a[0]||(a[0]=_=>e.$emit("toggleSidebar"))},{default:i(()=>[t(s)]),_:1}),p("span",Te,[I("MyChat2.0 "),t(ye)]),t($e)])}}},Ae=L(De,[["__scopeId","data-v-7d0ad1e5"]]),Me={class:"user-container"},He=["innerHTML"],Ve=p("img",{src:z,alt:"user",class:"userImg"},null,-1),Pe={__name:"user",props:{content:String},setup(r){return(e,a)=>{const s=l("el-card");return u(),g("div",Me,[t(s,{class:"userCard"},{default:i(()=>[p("p",{innerHTML:r.content,class:"markdown-body"},null,8,He)]),_:1}),Ve])}}},Be={class:"assistant-container"},Ne=["src"],Ee=["innerHTML"],J={__name:"assistant",props:{content:String},setup(r){const e=P();return(a,s)=>{const c=l("el-card");return u(),g("div",Be,[p("img",{src:f(e).AIphoto,alt:"assistant",class:"assistantImg"},null,8,Ne),t(c,{class:"assistantCard"},{default:i(()=>[p("p",{innerHTML:r.content,class:"markdown-body"},null,8,Ee)]),_:1})])}}};function Oe(){const r=w(null);let e=!0;const a=()=>{const c=r.value;c.scrollTop=c.scrollHeight-c.clientHeight},s=()=>{const c=r.value;c.scrollHeight-c.clientHeight-5<=c.scrollTop?e=!0:e=!1};return k(()=>{const c=r.value;new MutationObserver(()=>{e&&E(()=>{a()})}).observe(c,{childList:!0,subtree:!0}),E(()=>{a()})}),{chatContainer:r,handleScroll:s}}const Je={__name:"mainPart",setup(r){const{chatContainer:e,handleScroll:a}=Oe(),s=P(),c=T();return(_,o)=>(u(),g("div",{class:"chat-container",ref_key:"chatContainer",ref:e,onScroll:o[0]||(o[0]=(...n)=>f(a)&&f(a)(...n))},[t(J,{content:f(s).prologue},null,8,["content"]),(u(!0),g($,null,V(f(c).messageList,(n,d)=>(u(),g("div",{key:d},[t(Pe,{content:n.user},null,8,["content"]),t(J,{content:n.assistant},null,8,["content"])]))),128))],544))}},Ge=L(Je,[["__scopeId","data-v-25b65590"]]),Ue={class:"container"},ze=["onClick"],Fe=["src"],qe={__name:"GPTs",emits:["closeDrawer"],setup(r,{emit:e}){const a=D(),s=P(),c=w([]);k(async()=>{try{const n=await Q.get("/api/GPTs/");c.value=n.data}catch(n){console.error("请求数据时发生错误:",n)}});const _=e,o=n=>{a.addConversationToHistory(),s.setprologue(n.prologue),s.setUrl(n.url),s.setAImodel(n.title),s.setAIphoto(n.img),_("closeDrawer")};return(n,d)=>(u(),g("div",Ue,[(u(!0),g($,null,V(c.value,(m,h)=>(u(),g("div",{class:"item",key:h,onClick:b=>o(m)},[p("img",{style:{"border-radius":"100%"},src:m.img,alt:"图片"},null,8,Fe),p("h3",null,C(m.title),1),p("p",null,C(m.context),1)],8,ze))),128))]))}},Re=L(qe,[["__scopeId","data-v-3336bc37"]]),We={class:"icon-text-container"},G={__name:"footbar",setup(r){const e=w(!1),a=[{icon:Y,text:"聊天"},{icon:Z,text:"GPTs"},{icon:ee,text:"绘画"},{icon:te,text:"更多"}],s=w("btt"),c=w(0),_=o=>{c.value=o,o===1&&(e.value=!0)};return k(()=>{const o=()=>{window.innerWidth>1024?s.value="ltr":s.value="btt"};o(),window.addEventListener("resize",o)}),(o,n)=>{const d=l("el-icon"),m=l("el-col"),h=l("el-row"),b=l("el-drawer");return u(),g($,null,[t(h,null,{default:i(()=>[(u(),g($,null,V(a,(y,x)=>t(m,{key:x,span:6,class:B(["center-content",{active:c.value===x}]),onClick:A=>_(x)},{default:i(()=>[p("div",We,[t(d,{class:B({"active-icon":c.value===x})},{default:i(()=>[(u(),H(X(y.icon)))]),_:2},1032,["class"]),p("div",{class:B([{"active-text":c.value===x},"icon-text"])},C(y.text),3)])]),_:2},1032,["onClick","class"])),64))]),_:1}),t(b,{modelValue:e.value,"onUpdate:modelValue":n[1]||(n[1]=y=>e.value=y),title:"GPTs",direction:s.value,size:500},{default:i(()=>[t(Re,{onCloseDrawer:n[0]||(n[0]=y=>e.value=!1)})]),_:1},8,["modelValue","direction"])],64)}}},je={class:"input-container"},Ke=["disabled"],Qe={__name:"inputbar",setup(r){const e=w(null),a=()=>{const o=e.value;o.style.height="40px",o.style.height=`${o.scrollHeight}px`};k(()=>{a()});const s=T(),c=o=>{if(o.keyCode===13&&!o.shiftKey){o.preventDefault(),s.sendMessage();const n=e.value;n.style.height="40px"}},_=()=>{s.sendMessage();const o=e.value;o.style.height="40px"};return(o,n)=>{const d=l("Promotion"),m=l("el-icon"),h=l("Paperclip");return u(),g("div",je,[U(p("textarea",{placeholder:"请输入问题",class:"inputstyle",onInput:a,ref_key:"textarea",ref:e,"onUpdate:modelValue":n[0]||(n[0]=b=>f(s).user=b),onKeyup:ne(c,["enter"])},null,544),[[oe,f(s).user]]),p("button",{class:"send-button",onClick:_,disabled:f(s).loading},[t(m,{style:{"font-size":"20px",margin:"0"}},{default:i(()=>[t(d)]),_:1})],8,Ke),t(m,{class:"Paperclip"},{default:i(()=>[t(h)]),_:1})])}}},Xe=L(Qe,[["__scopeId","data-v-fc67ad12"]]),Ye={class:"common-layout"},ot={__name:"home",setup(r){const e=w(!1),a=w(null);function s(){e.value=!e.value}return(c,_)=>{const o=l("el-aside"),n=l("el-header"),d=l("el-main"),m=l("el-footer"),h=l("el-container");return u(),g("div",Ye,[t(h,null,{default:i(()=>[t(o,{class:"menu"},{default:i(()=>[t(G)]),_:1}),t(se,{name:"slide-fade"},{default:i(()=>[U(t(o,{class:"sidebar",ref_key:"sidebarRef",ref:a},{default:i(()=>[t(he,{onToggleSidebar:s})]),_:1},512),[[ae,e.value]])]),_:1}),t(h,null,{default:i(()=>[t(n,{class:"headbar"},{default:i(()=>[t(Ae,{onToggleSidebar:s})]),_:1}),t(d,{class:"mainPart"},{default:i(()=>[t(Ge)]),_:1}),t(Xe),t(m,{class:"footbar"},{default:i(()=>[t(G)]),_:1})]),_:1})]),_:1})])}}};export{ot as default};
